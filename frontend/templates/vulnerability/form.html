<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ 'Edit' if vulnerability else 'New' }} Vulnerability — TITAN</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <header>
    <h1>
      <a href="/">TITAN</a> / 
      {% if event %}
        <a href="/events">Events</a> / 
        <a href="/events/{{ event.id }}">#{{ event.id }}</a> / 
      {% endif %}
      {{ 'Edit' if vulnerability else 'New' }} Vulnerability
    </h1>
  </header>

  <main>
    <form method="post" action="{{ action }}" class="form" style="max-width: 600px;">
      <div class="form-group">
        <label>CVE ID</label>
        <input type="text" name="cve_id" placeholder="CVE-2024-1234" value="{{ vulnerability.cve_id if vulnerability else '' }}">
      </div>
      
      <div class="form-group">
        <label>Title *</label>
        <input type="text" name="title" required value="{{ vulnerability.title if vulnerability else '' }}">
      </div>
      
      <div class="form-group">
        <label>Severity</label>
        <select name="severity">
          <option value="">None</option>
          <option value="critical" {% if vulnerability and vulnerability.severity == 'critical' %}selected{% endif %}>Critical</option>
          <option value="high" {% if vulnerability and vulnerability.severity == 'high' %}selected{% endif %}>High</option>
          <option value="medium" {% if vulnerability and vulnerability.severity == 'medium' %}selected{% endif %}>Medium</option>
          <option value="low" {% if vulnerability and vulnerability.severity == 'low' %}selected{% endif %}>Low</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>CVSS Score</label>
        <input type="text" name="cvss_score" placeholder="9.8" value="{{ vulnerability.cvss_score if vulnerability else '' }}">
      </div>
      
      <div class="form-group">
        <label>Affected Product</label>
        <input type="text" name="affected_product" value="{{ vulnerability.affected_product if vulnerability else '' }}">
      </div>
      
      <div class="form-group">
        <label>Affected Version</label>
        <input type="text" name="affected_version" value="{{ vulnerability.affected_version if vulnerability else '' }}">
      </div>
      
      <div class="form-group">
        <label>Description</label>
        <textarea name="description" rows="3">{{ vulnerability.description if vulnerability else '' }}</textarea>
      </div>
      
      <div class="form-group">
        <label>Discovered Date</label>
        <input type="date" name="discovered_date" value="{{ vulnerability.discovered_date.strftime('%Y-%m-%d') if vulnerability and vulnerability.discovered_date else '' }}">
      </div>
      
      <div class="form-group">
        <label>Patched Date</label>
        <input type="date" name="patched_date" value="{{ vulnerability.patched_date.strftime('%Y-%m-%d') if vulnerability and vulnerability.patched_date else '' }}">
      </div>
      
      <div class="form-group">
        <label>
          <input type="checkbox" name="patch_available" value="on" {% if vulnerability and vulnerability.patch_available %}checked{% endif %}>
          Patch Available
        </label>
      </div>
      
      <div class="form-group">
        <label>Patch Details</label>
        <textarea name="patch_details" rows="2">{{ vulnerability.patch_details if vulnerability else '' }}</textarea>
      </div>

      <div style="margin-top:1.5rem;">
        <button type="submit" class="btn btn-primary">{{ 'Update' if vulnerability else 'Create' }} Vulnerability</button>
        <a href="{% if event %}/events/{{ event.id }}{% else %}/vulnerabilities{% endif %}" class="btn">Cancel</a>
      </div>
    </form>
  </main>

  <footer>
    <p class="muted">
      <a href="{% if event %}/events/{{ event.id }}{% else %}/vulnerabilities{% endif %}">← Back</a>
    </p>
  </footer>
</body>
</html>
